---
title: "Exploring the package {rnaturalearth} in R"
author: "Aditya Dahiya"
subtitle: "Various types of maps and geographic data available with {rnaturalearth}"
date: "2025-02-08"
bibliography: references.bib
format:
  html:
    code-fold: true
editor_options: 
  chunk_output_type: console
execute: 
  error: false
  message: false
  warning: false
  eval: false
categories:
  - "Maps"
  - "Gecomputation"
  - "{rnaturalearth}"
comments:
  giscus: 
    repo: Aditya-Dahiya/visage
filters:
  - social-share
share:
  permalink: "https://aditya-dahiya.github.io/visage/geocomputation/rnaturalearth_package.html"
  description: "Visualizing Information and Spatial Analysis with ggplot2 Extensions"
  twitter: true
  linkedin: true
  email: true
  mastodon: true
  facebook: true
---

## Introduction

```{r}
#| label: setup

# Data wrangling & visualization
library(tidyverse)  # Data manipulation & visualization

# Spatial data handling
library(sf)         # Import, export, and manipulate vector data
library(terra)      # Import, export, and manipulate raster data

# ggplot2 extensions
library(tidyterra)  # Helper functions for using terra with ggplot2

# Final plot tools
library(scales)               # Nice Scales for ggplot2
library(fontawesome)          # Icons display in ggplot2
library(ggtext)               # Markdown text in ggplot2
library(showtext)             # Display fonts in ggplot2
library(patchwork)            # Composing Plots

# Package to explore
library(rnaturalearth)        # Open Source Geographic data

bts = 12 # Base Text Size
sysfonts::font_add_google("Roboto Condensed", "body_font")
sysfonts::font_add_google("Oswald", "title_font")
showtext::showtext_auto()
# A base Colour
bg_col <- "white"
seecolor::print_color(bg_col)

# Colour for highlighted text
text_hil <- "grey30"
seecolor::print_color(text_hil)

# Colour for the text
text_col <- "grey20"
seecolor::print_color(text_col)

theme_set(
  theme_minimal(
    base_size = bts,
    base_family = "body_font"
  ) +
    theme(
      text = element_text(
        colour = "grey30",
        lineheight = 0.3,
        margin = margin(0,0,0,0, "pt")
      ),
      plot.title = element_text(
        hjust = 0.5
      ),
      plot.subtitle = element_text(
        hjust = 0.5
      )
    )
)

# Caption stuff for the plot
sysfonts::font_add(
  family = "Font Awesome 6 Brands",
  regular = here::here("docs", "Font Awesome 6 Brands-Regular-400.otf")
)
github <- "&#xf09b"
github_username <- "aditya-dahiya"
xtwitter <- "&#xe61b"
xtwitter_username <- "@adityadahiyaias"
social_caption_1 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{github};</span> <span style='color: {text_hil}'>{github_username}  </span>")
social_caption_2 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{xtwitter};</span> <span style='color: {text_hil}'>{xtwitter_username}</span>")
plot_caption <- paste0(
  "**Tools**: {rnaturalearth}  ",
  "  |  **Code:** ", 
  social_caption_1, 
  " |  **Graphics:** ", 
  social_caption_2
  )
rm(github, github_username, xtwitter, 
   xtwitter_username, social_caption_1, 
   social_caption_2)

```

Basic plot of World Map

```{r}
world1 <- rnaturalearth::ne_countries(
  scale = "medium",
  returnclass = "sf"
)

g <- ggplot(world1) +
  geom_sf(
    fill = NA, colour = "grey30",
    linewidth = 0.1
  ) +
  coord_sf(
    crs = "ESRI:54030"
  ) +
  labs(
    title = "Basic world map with ne_countries()"
  ) +
  theme(
    plot.title = element_textbox(
      hjust = 0.5, 
      halign = 0.5
    ),
    panel.grid = element_line(
      linewidth = 0.05, 
      colour = "grey20",
      linetype = 2
    )
  )

ggsave(
  plot = g,
  filename = here::here(
    "geocomputation", "images",
     "rnaturalearth_package_1.png"
  ),
  height = 500,
  width = 800,
  units = "px"
)
```

![Basic World map with ne_countries()](images/rnaturalearth_package_1.png){#fig-1}

World Coastline Map

```{r}
world1 <- rnaturalearth::ne_coastline(
  scale = "medium",
  returnclass = "sf"
)

g <- ggplot(world1) +
  geom_sf(
    fill = NA, colour = "grey30",
    linewidth = 0.1
  ) +
  coord_sf(
    crs = "ESRI:54030"
  ) +
  labs(
    title = "Basic Coastline map with ne_coastline()"
  ) +
  theme(
    plot.title = element_textbox(
      hjust = 0.5, 
      halign = 0.5
    ),
    panel.grid = element_line(
      linewidth = 0.05, 
      colour = "grey20",
      linetype = 2
    )
  )

ggsave(
  plot = g,
  filename = here::here(
    "geocomputation", "images",
     "rnaturalearth_package_2.png"
  ),
  height = 500,
  width = 800,
  units = "px"
)
```

![](images/rnaturalearth_package_2.png)

### Geographic lines with ne_download()

```{r}
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/physical/ne_50m_geographic_lines.zip
library(magick)
library(animation)
world_map <- ne_countries(
  scale = 110,
  returnclass = "sf"
)

world_lines <- ne_download(
  scale = 50,
  type = "geographic_lines",
  returnclass = "sf",
  category = "physical"
) |> 
  select(name)

animation::saveGIF(
  expr = for (i in seq(90, -90, -.5)) {
      # Create custom LAEA projection focussed around I.D.L.
      new_crs = paste0(
        "+proj=laea +x_0=0 +y_0=0 +lon_0=", j, 
        " +lat_0=", i)
  
      a <- ggplot() +
        geom_sf(
          data = world_lines, 
          mapping = aes(
            linewidth = name == "International Date Line"
            ),
          colour = "red"
          ) +
        scale_linewidth_manual(values = c(0.1, 0.5)) +
        geom_sf(data = world_map, fill = NA) +
        coord_sf(crs = new_crs, expand = FALSE) +
        labs(
          title = "International Date Line"
        ) +
        theme(
          legend.position = "none",
          axis.text = element_blank(),
          axis.title = element_blank(),
          axis.ticks.length = unit(0, "pt")
        )
      print(a)
      },
  movie.name = here::here(
    "geocomputation", "images",
    "rnaturalearth_package_1.gif"
  ),
  clean = TRUE,
  ani.height = 450,
  ani.width = 450,
  ani.loop = TRUE,
  interval = 0.02
)


animation::saveGIF(
  expr = 
    for (j in c(180, -180)){
      
      i_vec <- ifelse(
        j == 180, 
        seq(90, -90, -0.5),
        seq(-90, 90, 0.5)
      )
      
      for (i in i_vec) {
      # Create custom LAEA projection focussed around I.D.L.
      new_crs = paste0(
        "+proj=laea +x_0=0 +y_0=0 +lon_0=", j, 
        " +lat_0=", i)
  
      a <- ggplot() +
        geom_sf(
          data = world_lines, 
          mapping = aes(
            linewidth = name == "International Date Line"
            ),
          colour = "red"
          ) +
        scale_linewidth_manual(values = c(0.1, 0.5)) +
        geom_sf(data = world_map, fill = NA) +
        coord_sf(crs = new_crs, expand = FALSE) +
        labs(
          title = "International Date Line"
        ) +
        theme(
          legend.position = "none"
        )
      print(a)
      }
    },
  movie.name = here::here(
    "geocomputation", "images",
    "rnaturalearth_package_1.gif"
  ),
  clean = TRUE,
  ani.height = 450,
  ani.width = 450,
  ani.loop = TRUE,
  interval = 1
)
# Create custom LAEA projection focussed around I.D.L.
new_crs = paste0(
    "+proj=laea +x_0=0 +y_0=0 +lon_0=", 180, 
    " +lat_0=", 0)

ggplot() +
  geom_sf(data = world_lines, colour = "red") +
  geom_sf(data = world_map, fill = alpha("grey", 0.2)) +
  coord_sf(crs = new_crs) 

world_lines |> 
  ggplot() +
  geom_sf() +
  coord_sf(crs = "ESRI:54030")
```

![](images/rnaturalearth_package_1.gif)

### ne_states() with India

```{r}

# Get border map of Uttarakhand
uk_state = ne_states(country = "India", returnclass = "sf") |> 
  select(iso_3166_2, name, geometry) |> 
  filter(name == "Uttarakhand")


# Get Rivers of Uttarakhand
# https://www.naturalearthdata.com/downloads/50m-physical-vectors/
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/physical/ne_50m_rivers_lake_centerlines.zip
uk_rivers <- ne_download(
  scale = 10,
  type = "rivers_lake_centerlines",
  category = "physical",
  returnclass = "sf"
) |> 
  st_intersection(uk_state)

# Get Lakes of Uttarakhand
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/physical/ne_50m_lakes.zip
uk_lakes <- ne_download(
  scale = 50,
  type = "lakes",
  category = "physical",
  returnclass = "sf"
)

uk_lakes |> 
  ggplot() +
  geom_sf()

uk_rivers |> 
  ggplot() +
  geom_sf()

uk_state |> 
  ggplot() +
  geom_sf()
```

### Exploring `ne_download()`

**type**

:   type of natural earth file to download one of 'countries', 'map_units', 'map_subunits', 'sovereignty', 'states' OR the portion of any natural earth vector url after the scale and before the . e.g. for 'ne_50m_urban_areas.zip' this would be 'urban_areas'. See Details. OR the raster filename e.g. for 'MSR_50M.zip' this would be 'MSR_50M'

Target: to download raster from <https://www.naturalearthdata.com/downloads/10m-raster-data/10m-cross-blend-hypso/>

Target 2: understand how to download <https://www.naturalearthdata.com/downloads/50m-physical-vectors/> features.

```{r}
rnaturalearthhires::states10 |> 
  ggplot() +
  geom_sf()

rast1 <- ne_download(
  scale = 10, 
  type = "MSR_50M", 
  category = "raster", 
  destdir = tempdir()
  )

ggplot()

rast1
```
